{% extends "base.html" %}
{% block title %}Customer Summary{% endblock %}

{% block content %}
<div class="container mt-4">
  <div class="card shadow-lg border-0 rounded-4">
    <div class="card-header text-white text-center rounded-top-4"
         style="background: linear-gradient(90deg, #007bff, #00b4d8);">
      <h3 class="fw-bold mb-0">
        <i class="bi bi-person-lines-fill me-2"></i> Customer Outstanding Summary
      </h3>
    </div>

    <div class="card-body bg-light">
      {% if customers %}
      <div class="table-responsive">
        <table class="table table-bordered align-middle text-center table-hover">
          <thead style="background: linear-gradient(90deg, #007bff, #00b4d8); color: white;">
            <tr>
              <th>#</th>
              <th>Customer Name</th>
              <th>Phone</th>
              <th>Bill Total (â‚¹)</th>
              <th>Estimate Total (â‚¹)</th>
              <th><strong>Total Udhar (â‚¹)</strong></th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody>
            {% for cust in customers %}
            <tr>
              <td>{{ forloop.counter }}</td>
              <td class="fw-semibold">{{ cust.customer_name }}</td>
              <td>{{ cust.customer_phone|default:"â€”" }}</td>
              <td>â‚¹ {{ cust.total_bills|floatformat:2 }}</td>
              <td>â‚¹ {{ cust.total_estimates|floatformat:2 }}</td>
              <td class="fw-bold text-primary">â‚¹ {{ cust.total_udhar|floatformat:2 }}</td>
              <td class="d-flex justify-content-center gap-2 flex-wrap">

                <!-- ðŸ‘ï¸ View Bills -->
                <a href="{% url 'customer_detail' cust.customer_name %}" class="btn btn-primary btn-sm">
                  <i class="bi bi-eye"></i> View Bills
                </a>

                <!-- ðŸ’° Pending / Paid -->
                {% if cust.remaining_balance > 0 %}
                  <a href="{% url 'add_payment' cust.customer_name %}" class="btn btn-success btn-sm">
                    <i class="bi bi-cash-coin"></i> Pending â‚¹{{ cust.remaining_balance|floatformat:2 }}
                  </a>
                {% else %}
                  <button class="btn btn-secondary btn-sm" disabled>
                    <i class="bi bi-check2-circle"></i> Paid
                  </button>
                {% endif %}

                <!-- ðŸ—‘ï¸ Delete Customer -->
                <form method="POST" action="{% url 'delete_customer' cust.customer_name %}"
                      onsubmit="return confirm('âš ï¸ Are you sure you want to delete {{ cust.customer_name }} and all related data?');"
                      class="d-inline">
                  {% csrf_token %}
                  <button type="submit" class="btn btn-danger btn-sm">
                    <i class="bi bi-trash"></i> Delete
                  </button>
                </form>

              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      {% else %}
      <p class="text-center text-muted my-4">No customer data found.</p>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %}
